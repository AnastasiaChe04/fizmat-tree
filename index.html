<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–§–∏–∑–º–∞—Ç ‚Äî –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            margin: 0;
            font-family: Inter, sans-serif;
            background: linear-gradient(135deg, #0f172a, #0b1220);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .stage {
            width: min(980px, 92vw);
            height: min(700px, 86vh);
            position: relative;
            border-radius: 18px;
            box-shadow: 0 10px 40px rgba(2, 6, 23, .6);
            overflow: hidden;
            background: rgba(255, 255, 255, 0.03);
        }

        .section {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s;
            opacity: 0;
            pointer-events: none;
        }

        .section.active {
            opacity: 1;
            pointer-events: auto;
        }

        .greet img {
            max-width: 70%;
            height: auto;
        }

        button {
            margin-top: 20px;
            padding: 12px 34px;
            font-size: 18px;
            color: #fff;
            background: linear-gradient(90deg, #4b6cb7, #182848);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 14px rgba(0, 0, 0, .4);
        }

        .cards {
            text-align: center;
            padding: 20px;
        }

        .card {
            font-size: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 12px;
            max-width: 80%;
            backdrop-filter: blur(8px);
            margin-bottom: 20px;
        }

        .card-nav {
            display: flex;
            gap: 20px;
        }

        .add-section {
            margin-top: 20px;
        }

        textarea {
            width: 300px;
            height: 80px;
            padding: 10px;
            border-radius: 8px;
            border: none;
            resize: none;
        }
    </style>
</head>

<body>
    <div class="stage">
        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <div class="section greet active" id="greet">
            <img src="17.png" alt="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ">
            <button id="startBtn">–ü—É—Å–∫</button>
        </div>

        <!-- –§—Ä–∞–∑–∞ -->
        <div class="section final" id="final">
            <h2>–§–∏–∑–º–∞—Ç ‚Äî —ç—Ç–æ –Ω–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç, —ç—Ç–æ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</h2>
            <img src="17a.jpg" alt="–§–∏–∑–º–∞—Ç">
            <button id="nextBtn">–ü—É—Å–∫</button>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="section cards" id="cards">
            <div class="card" id="cardText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="card-nav">
                <button id="prevCard">–ù–∞–∑–∞–¥</button>
                <button id="nextCard">–î–∞–ª–µ–µ</button>
            </div>

            <div class="add-section">
                <textarea id="newText" placeholder="–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π —Ç–µ–∫—Å—Ç..."></textarea><br>
                <button id="addTextBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Supabase
        const SUPABASE_URL = "https://ajhtpxprvlxgpafopmmd.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqaHRweHBydmx4Z3BhZm9wbW1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NjI2NzksImV4cCI6MjA3NzMzODY3OX0.1k0M4u3aOtLTgmmG1d4m5AqBNrsz68RHlrLmkINkfqc";

        const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const greet = document.getElementById('greet');
        const final = document.getElementById('final');
        const cards = document.getElementById('cards');
        const startBtn = document.getElementById('startBtn');
        const nextBtn = document.getElementById('nextBtn');

        const cardText = document.getElementById('cardText');
        const prevCard = document.getElementById('prevCard');
        const nextCard = document.getElementById('nextCard');
        const addTextBtn = document.getElementById('addTextBtn');
        const newText = document.getElementById('newText');

        let messages = [];
        let current = 0;

        startBtn.addEventListener('click', () => {
            startBtn.style.display = "none";
            greet.classList.remove('active');
            setTimeout(() => final.classList.add('active'), 800);
        });

        nextBtn.addEventListener('click', () => {
            final.classList.remove('active');
            setTimeout(() => {
                cards.classList.add('active');
                loadMessages();
            }, 800);
        });

        async function loadMessages() {
            const { data, error } = await client
                .from('messages')
                .select('*')
                .order('id', { ascending: true });

            if (error) {
                console.error(error);
                cardText.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö üò¢";
                return;
            }

            messages = data.map(m => m.text);
            if (messages.length === 0) {
                cardText.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ!";
            } else {
                current = 0;
                showCard(current);
            }
        }

        function showCard(i) {
            cardText.textContent = messages[i] || "–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π.";
        }

        prevCard.addEventListener('click', () => {
            if (current > 0) {
                current--;
                showCard(current);
            }
        });

        nextCard.addEventListener('click', () => {
            if (current < messages.length - 1) {
                current++;
                showCard(current);
            }
        });

        addTextBtn.addEventListener('click', async () => {
            const text = newText.value.trim();
            if (!text) return;

            const { error } = await client.from('messages').insert([{ text }]);
            if (error) {
                alert("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞");
                console.error(error);
                return;
            }

            newText.value = "";
            await loadMessages();
            current = messages.length - 1;
            showCard(current);
        });
    </script>
</body>

</html>
